<%- include('../layouts/main', { body: `
<div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="admin-sidebar-header">
            <a href="/admin" class="admin-sidebar-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                <span>Admin Panel</span>
            </a>
        </div>
        <nav class="admin-sidebar-nav">
            <a href="/admin">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span>Overview</span>
            </a>
            <a href="/admin/users" class="active">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                <span>Users</span>
            </a>
            <a href="/admin/analytics">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                <span>Analytics</span>
            </a>
            <a href="/admin/email">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                <span>Email</span>
            </a>
        </nav>
        <div class="admin-sidebar-footer">
            <a href="/" class="admin-back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
                <span>Back to Site</span>
            </a>
        </div>
    </aside>

    <div class="admin-main">
        <div class="admin-page-header">
            <h1>Users</h1>
            <p>${users.length} registered users</p>
        </div>

        <div class="admin-table-wrapper">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Handicap</th>
                        <th>Games</th>
                        <th>Rating</th>
                        <th>Status</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${users.map(u => `
                    <tr class="${u.suspended ? 'suspended-row' : ''}">
                        <td>${u.id}</td>
                        <td><a href="/profile/${u.id}">${u.display_name}</a></td>
                        <td>${u.email}</td>
                        <td>${u.handicap !== null ? u.handicap : '-'}</td>
                        <td>${u.games_played || 0}</td>
                        <td>${u.average_rating ? parseFloat(u.average_rating).toFixed(1) : '-'}</td>
                        <td>
                            ${u.suspended
                                ? '<span class="badge badge-danger">Suspended</span>'
                                : u.email_verified
                                    ? '<span class="badge badge-success">Active</span>'
                                    : '<span class="badge badge-warning">Unverified</span>'
                            }
                        </td>
                        <td>${new Date(u.created_at).toLocaleDateString()}</td>
                        <td>
                            ${u.suspended
                                ? '<form action="/admin/users/' + u.id + '/unsuspend" method="POST" style="display:inline;"><input type="hidden" name="_csrf" value="' + csrfToken + '"><button type="submit" class="btn btn-sm btn-success">Unsuspend</button></form>'
                                : '<button type="button" class="btn btn-sm btn-danger" onclick="showSuspendModal(' + u.id + ', &quot;' + u.display_name.replace(/"/g, '') + '&quot;)">Suspend</button>'
                            }
                        </td>
                    </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Suspend Modal -->
<div id="suspendModal" class="modal" style="display:none;">
    <div class="modal-content">
        <h3>Suspend User</h3>
        <p>Suspend user: <strong id="suspendUserName"></strong></p>
        <form id="suspendForm" method="POST">
            <input type="hidden" name="_csrf" value="${csrfToken}">
            <div class="form-group">
                <label for="reason">Reason (optional)</label>
                <textarea id="reason" name="reason" rows="3" placeholder="Reason for suspension..."></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="closeSuspendModal()">Cancel</button>
                <button type="submit" class="btn btn-danger">Suspend User</button>
            </div>
        </form>
    </div>
</div>

<script>
function showSuspendModal(userId, userName) {
    document.getElementById('suspendUserName').textContent = userName;
    document.getElementById('suspendForm').action = '/admin/users/' + userId + '/suspend';
    document.getElementById('suspendModal').style.display = 'flex';
}
function closeSuspendModal() {
    document.getElementById('suspendModal').style.display = 'none';
}
</script>
` }) %>
