<%
// Prepare chart data as JSON string for use in script
const chartDataJson = JSON.stringify(data).replace(/</g, '\\u003c');
%>
<%- include('../layouts/main', { body: `
<div class="admin-page analytics-page">
    <div class="container">
        <div class="admin-header">
            <h1>Analytics Dashboard</h1>
            <div class="admin-header-actions">
                <a href="/admin" class="btn btn-secondary">Back to Admin</a>
            </div>
        </div>

        <div class="stats-grid stats-grid-4">
            <div class="stat-card">
                <div class="stat-number">${stats.totalUsers}</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.avgHandicap}</div>
                <div class="stat-label">Avg Handicap</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.totalGames}</div>
                <div class="stat-label">Total Games</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.completionRate}%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <h3>User Growth (Last 12 Months)</h3>
                <div class="chart-container"><canvas id="userGrowthChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Games Per Week (Last 12 Weeks)</h3>
                <div class="chart-container"><canvas id="gamesWeekChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row charts-row-3">
            <div class="chart-card">
                <h3>Gender Distribution</h3>
                <div class="chart-container"><canvas id="genderChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Age Distribution</h3>
                <div class="chart-container"><canvas id="ageChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Top Nationalities</h3>
                <div class="chart-container"><canvas id="nationalityChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <h3>Playing Level Distribution</h3>
                <div class="chart-container"><canvas id="levelChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Handicap Distribution</h3>
                <div class="chart-container"><canvas id="handicapChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <h3>Game Status</h3>
                <div class="chart-container"><canvas id="gameStatusChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Popular Courses</h3>
                <div class="chart-container"><canvas id="coursesChart"></canvas></div>
            </div>
        </div>
    </div>
</div>

<style>
.analytics-page { padding: var(--spacing-xl) 0 var(--spacing-2xl); }
.stats-grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); }
.charts-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); }
.charts-row-3 { grid-template-columns: repeat(3, 1fr); }
.chart-card { background: white; padding: var(--spacing-lg); border-radius: var(--radius-lg); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.chart-card h3 { margin-bottom: var(--spacing-md); font-size: 1rem; }
.chart-container { position: relative; height: 250px; }
@media (max-width: 1024px) { .stats-grid-4 { grid-template-columns: repeat(2, 1fr); } .charts-row, .charts-row-3 { grid-template-columns: 1fr; } }
@media (max-width: 640px) { .stats-grid-4 { grid-template-columns: 1fr; } }
</style>

<div id="chartData" data-charts="${chartDataJson.replace(/"/g, '&quot;')}"></div>
<script src="/js/chart.min.js"></script>
<script src="/js/analytics-charts.js"></script>
` }) %>
