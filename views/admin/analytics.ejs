<%
// Prepare chart data as JSON string for use in script
const chartDataJson = JSON.stringify(data).replace(/</g, '\\u003c');
%>
<%- include('../layouts/main', { body: `
<div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="admin-sidebar-header">
            <a href="/admin" class="admin-sidebar-logo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                <span>Admin Panel</span>
            </a>
        </div>
        <nav class="admin-sidebar-nav">
            <a href="/admin">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span>Overview</span>
            </a>
            <a href="/admin/users">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                <span>Users</span>
            </a>
            <a href="/admin/analytics" class="active">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                <span>Analytics</span>
            </a>
            <a href="/admin/email">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                <span>Email</span>
            </a>
        </nav>
        <div class="admin-sidebar-footer">
            <a href="/" class="admin-back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
                <span>Back to Site</span>
            </a>
        </div>
    </aside>

    <div class="admin-main">
        <div class="admin-page-header">
            <h1>Analytics</h1>
            <p>Platform statistics and insights</p>
        </div>

        <div class="stats-grid stats-grid-4">
            <div class="stat-card">
                <div class="stat-number">${stats.totalUsers}</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.avgHandicap}</div>
                <div class="stat-label">Avg Handicap</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.totalGames}</div>
                <div class="stat-label">Total Games</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${stats.completionRate}%</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <h3>User Growth (Last 12 Months)</h3>
                <div class="chart-container"><canvas id="userGrowthChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Games Per Week (Last 12 Weeks)</h3>
                <div class="chart-container"><canvas id="gamesWeekChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row charts-row-3">
            <div class="chart-card">
                <h3>Gender Distribution</h3>
                <div class="chart-container"><canvas id="genderChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Age Distribution</h3>
                <div class="chart-container"><canvas id="ageChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Top Nationalities</h3>
                <div class="chart-container"><canvas id="nationalityChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <h3>Playing Level Distribution</h3>
                <div class="chart-container"><canvas id="levelChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Handicap Distribution</h3>
                <div class="chart-container"><canvas id="handicapChart"></canvas></div>
            </div>
        </div>

        <div class="charts-row">
            <div class="chart-card">
                <h3>Game Status</h3>
                <div class="chart-container"><canvas id="gameStatusChart"></canvas></div>
            </div>
            <div class="chart-card">
                <h3>Popular Courses</h3>
                <div class="chart-container"><canvas id="coursesChart"></canvas></div>
            </div>
        </div>
    </div>
</div>

<div id="chartData" data-charts="${chartDataJson.replace(/"/g, '&quot;')}"></div>
<script src="/js/chart.min.js"></script>
<script src="/js/analytics-charts.js"></script>
` }) %>
