<%- include('../layouts/main', { body: `
<div class="notifications-page">
    <div class="container container-narrow">
        <div class="page-header-flex">
            <h1>Notifications</h1>
            ${notifications && notifications.some(n => !n.read) ?
                `<form action="/notifications/read-all" method="POST">
                    <button type="submit" class="btn btn-outline btn-sm">Mark all as read</button>
                </form>` : ''
            }
        </div>

        <div class="notifications-list">
            ${notifications && notifications.length > 0 ?
                notifications.map(notif => `
                    <a href="${!notif.read && notif.link ? '/notifications/' + notif.id + '/click?redirect=' + encodeURIComponent(notif.link) : (notif.link || '#')}"
                       class="notification-item ${notif.read ? 'read' : 'unread'}">
                        <div class="notification-icon ${notif.type}">
                            ${notif.type === 'game_request' ? '&#128101;' :
                              notif.type === 'game_accepted' ? '&#9989;' :
                              notif.type === 'game_declined' ? '&#10060;' :
                              notif.type === 'game_cancelled' ? '&#128683;' :
                              notif.type === 'player_withdrawn' ? '&#128694;' :
                              notif.type === 'invitation' ? '&#128231;' :
                              notif.type === 'rating_received' ? '&#11088;' :
                              notif.type === 'rate_players' ? '&#127942;' :
                              notif.type === 'new_message' ? '&#128172;' :
                              '&#128276;'}
                        </div>
                        <div class="notification-content">
                            <strong>${notif.title}</strong>
                            <p>${notif.message}</p>
                            <span class="notification-time" data-time="${notif.created_at}">${new Date(notif.created_at).toLocaleDateString()}</span>
                        </div>
                        ${!notif.read ? '<span class="notification-dot"></span>' : ''}
                    </a>
                `).join('') :
                `<div class="empty-state">
                    <p>No notifications yet.</p>
                </div>`
            }
        </div>
    </div>
</div>

<style>
.notifications-page { padding: var(--spacing-2xl) 0; }
.page-header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl); }
.notifications-list { display: flex; flex-direction: column; }
.notification-item { display: flex; align-items: flex-start; gap: var(--spacing-md); padding: var(--spacing-lg); background: white; border: 1px solid var(--color-border); border-bottom: none; color: var(--color-text); position: relative; }
.notification-item:first-child { border-radius: var(--radius-lg) var(--radius-lg) 0 0; }
.notification-item:last-child { border-bottom: 1px solid var(--color-border); border-radius: 0 0 var(--radius-lg) var(--radius-lg); }
.notification-item:only-child { border-radius: var(--radius-lg); border-bottom: 1px solid var(--color-border); }
.notification-item:hover { background: var(--color-bg-alt); text-decoration: none; }
.notification-item.unread { background: #f0f9ff; }
.notification-icon { width: 40px; height: 40px; border-radius: 50%; background: var(--color-bg-alt); display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
.notification-content { flex: 1; }
.notification-content strong { display: block; margin-bottom: var(--spacing-xs); }
.notification-content p { margin: 0; color: var(--color-text-muted); font-size: 0.875rem; }
.notification-time { font-size: 0.75rem; color: var(--color-text-muted); }
.notification-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--color-primary); position: absolute; top: var(--spacing-lg); right: var(--spacing-lg); }
</style>

<script>
function timeAgo(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const seconds = Math.floor((now - date) / 1000);

    if (seconds < 60) return 'Just now';
    if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
    if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
    if (seconds < 604800) return Math.floor(seconds / 86400) + 'd ago';
    return date.toLocaleDateString();
}

// Update time displays
document.querySelectorAll('.notification-time').forEach(el => {
    const created = el.dataset.time;
    if (created) {
        el.textContent = timeAgo(created);
    }
});
</script>
` }) %>
