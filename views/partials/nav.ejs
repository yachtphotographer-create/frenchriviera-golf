<header class="header">
    <nav class="nav container">
        <a href="/" class="nav-logo">
            <img src="/images/logo.png" alt="French Riviera Golf" class="nav-logo-img">
        </a>

        <% if (user) { %>
        <a href="/notifications" class="nav-notifications nav-notifications-mobile">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            <% if (unreadNotifications > 0) { %>
                <span class="notification-badge"><%= unreadNotifications > 9 ? '9+' : unreadNotifications %></span>
            <% } %>
        </a>
        <% } %>

        <button class="nav-toggle" aria-label="Toggle menu" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <!-- Desktop menu stays here -->
        <ul class="nav-menu nav-menu-desktop">
            <li><a href="/courses" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.courses : 'Courses' %></a></li>
            <li><a href="/blog" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.blog : 'Blog' %></a></li>
            <% if (user) { %>
                <li><a href="/games" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.findGames : 'Find Games' %></a></li>
                <li><a href="/available" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.players : 'Players' %></a></li>
                <li>
                    <a href="/notifications" class="nav-link nav-notifications">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                        <% if (unreadNotifications > 0) { %>
                            <span class="notification-badge"><%= unreadNotifications > 9 ? '9+' : unreadNotifications %></span>
                        <% } %>
                    </a>
                </li>
                <li class="nav-dropdown">
                    <button class="nav-link nav-dropdown-toggle">
                        <% if (user.profile_photo) { %>
                            <img src="<%= user.profile_photo %>" alt="" class="nav-avatar">
                        <% } else { %>
                            <span class="nav-avatar-placeholder"><%= user.display_name.charAt(0).toUpperCase() %></span>
                        <% } %>
                        <span><%= user.display_name %></span>
                    </button>
                    <ul class="nav-dropdown-menu">
                        <li><a href="/dashboard"><%= typeof t !== 'undefined' ? t.nav.dashboard : 'Dashboard' %></a></li>
                        <% if (user.email === 'yachtphotographer@gmail.com') { %>
                        <li><a href="/admin">Admin Panel</a></li>
                        <% } %>
                        <li><a href="/profile"><%= typeof t !== 'undefined' ? t.nav.myProfile : 'My Profile' %></a></li>
                        <li><a href="/profile/edit"><%= typeof t !== 'undefined' ? t.nav.editProfile : 'Edit Profile' %></a></li>
                        <li><a href="/games/mine"><%= typeof t !== 'undefined' ? t.nav.myGames : 'My Games' %></a></li>
                        <li><a href="/availability/create"><%= typeof t !== 'undefined' ? t.nav.setAvailability : 'Set Availability' %></a></li>
                        <li class="nav-dropdown-divider"></li>
                        <li><a href="/auth/logout"><%= typeof t !== 'undefined' ? t.nav.logout : 'Logout' %></a></li>
                    </ul>
                </li>
            <% } else { %>
                <li><a href="/auth/login" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.login : 'Login' %></a></li>
                <li><a href="/auth/register" class="btn btn-primary btn-sm"><%= typeof t !== 'undefined' ? t.nav.signUp : 'Sign Up' %></a></li>
            <% } %>

            <!-- Language Switcher -->
            <li class="nav-lang-switcher">
                <a href="?lang=en" class="lang-btn <%= (typeof lang !== 'undefined' && lang === 'en') ? 'active' : '' %>" title="English">EN</a>
                <span class="lang-divider">|</span>
                <a href="?lang=fr" class="lang-btn <%= (typeof lang !== 'undefined' && lang === 'fr') ? 'active' : '' %>" title="Français">FR</a>
            </li>
        </ul>
    </nav>
</header>

<!-- Mobile menu OUTSIDE header to fix iOS backdrop-filter bug -->
<div class="mobile-menu-overlay" id="mobile-menu-overlay" onclick="toggleMobileMenu()"></div>
<ul class="nav-menu nav-menu-mobile" id="nav-menu">
    <li><a href="/courses" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.courses : 'Courses' %></a></li>
    <li><a href="/blog" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.blog : 'Blog' %></a></li>
    <% if (user) { %>
        <li><a href="/games" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.findGames : 'Find Games' %></a></li>
        <li><a href="/available" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.players : 'Players' %></a></li>
        <li><a href="/notifications" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.notifications : 'Notifications' %></a></li>
        <li><a href="/dashboard" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.dashboard : 'Dashboard' %></a></li>
        <% if (user.email === 'yachtphotographer@gmail.com') { %>
        <li><a href="/admin" class="nav-link">Admin Panel</a></li>
        <% } %>
        <li><a href="/profile" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.myProfile : 'My Profile' %></a></li>
        <li><a href="/games/mine" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.myGames : 'My Games' %></a></li>
        <li><a href="/auth/logout" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.logout : 'Logout' %></a></li>
    <% } else { %>
        <li><a href="/auth/login" class="nav-link"><%= typeof t !== 'undefined' ? t.nav.login : 'Login' %></a></li>
        <li><a href="/auth/register" class="btn btn-primary"><%= typeof t !== 'undefined' ? t.nav.signUp : 'Sign Up' %></a></li>
    <% } %>
    <li class="nav-lang-switcher">
        <a href="?lang=en" class="lang-btn <%= (typeof lang !== 'undefined' && lang === 'en') ? 'active' : '' %>" title="English">EN</a>
        <span class="lang-divider">|</span>
        <a href="?lang=fr" class="lang-btn <%= (typeof lang !== 'undefined' && lang === 'fr') ? 'active' : '' %>" title="Français">FR</a>
    </li>
</ul>

<style>
.nav-notifications { position: relative; display: flex; align-items: center; }
.notification-badge { position: absolute; top: -5px; right: -8px; background: var(--color-error); color: white; font-size: 0.625rem; font-weight: 600; padding: 2px 5px; border-radius: 10px; min-width: 16px; text-align: center; }
.nav-notifications-mobile { display: none; margin-right: 12px; color: var(--color-text); }
@media (max-width: 768px) {
    .nav-notifications-mobile { display: flex; }
}
</style>
